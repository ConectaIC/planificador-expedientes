import { NextRequest, NextResponse } from 'next/server';
import { supabaseAdmin } from '../../../lib/supabaseAdmin';
export async function POST(req:NextRequest){try{const body=await req.json();const fecha=body.fecha?new Date(body.fecha):null;const horas=body.horas?parseFloat(body.horas):null;const inicio=body.inicio??null;const fin=body.fin??null;const expedienteCodigo=String(body.expediente||'').trim();const comentario=String(body.comentario||'');const sb=supabaseAdmin();let expediente_id:string|null=null;if(expedienteCodigo){const {data:exp,error:eExp}=await sb.from('expedientes').select('id').eq('codigo',expedienteCodigo).maybeSingle();if(eExp) throw eExp;expediente_id=exp?.id??null;}const {error}=await sb.from('partes').insert({fecha,hora_inicio:inicio,hora_fin:fin,horas,comentario,expediente_id});if(error) throw error;return NextResponse.json({ok:true});}catch(e:any){return NextResponse.json({ok:false,error:e.message},{status:400});}}
